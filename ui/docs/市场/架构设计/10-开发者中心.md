# 开发者中心模块设计

## 文档版本
- 版本：2.0
- 更新日期：2026-01-12

---

## 1. 模块概述

开发者中心是插件开发者管理自己插件的页面，包括：
- 我的插件列表
- 上传新插件
- 版本管理
- 价格设置
- 数据统计

---

## 2. 页面访问控制

### 2.1 访问要求

| 条件 | 处理方式 |
|------|----------|
| 未登录 | 重定向到登录页 |
| 已登录但非开发者 | 显示无权限页面 + 申请开发者入口 |
| 已登录且是开发者 | 正常显示页面 |

### 2.2 访问检查流程

```
用户访问 /developer
    │
    ▼
获取 Session
    │
    ├── 未登录 ────→ 重定向到 /sign-in?callbackUrl=/developer
    │
    └── 已登录
            │
            ▼
        用户角色是否为 developer 或 admin？
            │
            ├── 否 ────→ 显示无权限页面
            │            "开发者中心仅对开发者开放"
            │            [申请成为开发者]
            │
            └── 是 ────→ 正常渲染页面
```

---

## 3. 页面结构设计

### 3.1 整体布局

```
┌─────────────────────────────────────────────────────────────────┐
│  页面头部                                         [上传新插件]   │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ 标题：开发者中心                                             ││
│  │ 描述：管理您上传的插件                                       ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────────┐
│  统计卡片区域                                                    │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐              │
│  │ 全部插件 │ │ 已上架  │ │ 总下载  │ │预估收入 │              │
│  │    8    │ │    5   │ │  1.2K  │ │ ¥2,500 │              │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘              │
└─────────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────────┐
│  [我的插件] [数据统计]                                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Tab 内容区域                                                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 组件层级

```
DeveloperPage (Server Component)
├── PageHeader
│   └── UploadButton
├── StatsCards
└── Tabs
    ├── MyPluginsTab (Client Component)
    └── StatsTab (Client Component)
```

---

## 4. 我的插件 Tab 设计

### 4.1 列表结构

```
┌─────────────────────────────────────────────────────────────────┐
│  插件 │ 版本 │ 价格 │ 下载量 │ 评分 │ 状态 │ 操作              │
├─────────────────────────────────────────────────────────────────┤
│  📦 插件1 │ v1.2.0 │ 免费 │ 1,234 │ ★4.5 │ 🟢已上架 │ [更多▼]│
│  📦 插件2 │ v2.0.0 │ ¥99 │ 567 │ ★4.8 │ 🟢已上架 │ [更多▼]  │
│  📦 插件3 │ v1.0.0 │ 免费 │ 0 │ - │ 🟡审核中 │ [更多▼]        │
│  📦 插件4 │ v1.0.0 │ 免费 │ 0 │ - │ 🔴被拒绝 │ [更多▼]        │
│  ...                                                            │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 插件状态说明

| 状态 | 值 | 图标 | 说明 |
|------|-----|------|------|
| 审核中 | pending | 🟡 | 等待平台审核 |
| 已上架 | approved | 🟢 | 已通过审核，用户可见 |
| 被拒绝 | rejected | 🔴 | 审核未通过 |
| 已下架 | removed | ⚫ | 开发者主动下架 |

### 4.3 操作菜单

| 操作 | 适用状态 | 说明 |
|------|----------|------|
| 查看详情 | 所有 | 跳转到插件详情页 |
| 发布新版本 | approved | 发布新版本 |
| 价格设置 | approved | 修改价格设置 |
| 下架插件 | approved | 将插件从市场下架 |
| 删除插件 | pending, rejected, removed | 删除插件 |

---

## 5. 上传新插件流程

### 5.1 上传流程

```
用户点击"上传新插件"按钮
    │
    ▼
弹出上传对话框
    │
    ▼
填写插件信息
┌─────────────────────────────────────────┐
│  上传新插件                              │
│                                         │
│  插件名称 *                             │
│  ┌─────────────────────────────────────┐│
│  │                                     ││
│  └─────────────────────────────────────┘│
│                                         │
│  插件描述 *                             │
│  ┌─────────────────────────────────────┐│
│  │                                     ││
│  │                                     ││
│  └─────────────────────────────────────┘│
│                                         │
│  插件分类 *                             │
│  [选择分类 ▼]                           │
│                                         │
│  付费类型                               │
│  ○ 免费  ● 付费                        │
│                                         │
│  （付费时显示）                         │
│  价格 *           收费模式 *            │
│  ┌──────┐         [一次性购买 ▼]       │
│  │  99  │                              │
│  └──────┘                              │
│                                         │
│  插件包 *                               │
│  ┌─────────────────────────────────────┐│
│  │  拖放文件到此处，或点击选择          ││
│  │  支持 .zip 格式，最大 50MB          ││
│  └─────────────────────────────────────┘│
│                                         │
│            [取消]  [提交审核]           │
└─────────────────────────────────────────┘
    │
    ▼
表单验证
    │
    ├── 验证失败 ────→ 显示错误提示
    │
    └── 验证通过
            │
            ▼
        调用上传 Server Action
            │
            ▼
┌─────────────────────────────────────────┐
│           Server Action 处理            │
│                                         │
│ 1. 验证用户是开发者                     │
│ 2. 验证表单数据                         │
│ 3. 验证文件格式和大小                   │
│ 4. 存储插件包文件                       │
│ 5. 创建插件记录（状态：pending）        │
│ 6. 创建版本记录（v1.0.0）               │
│ 7. 发送审核通知给平台管理员             │
│ 8. 重新验证相关页面缓存                 │
└─────────────────────────────────────────┘
    │
    ├── 成功 ────→ 显示成功提示
    │              "插件上传成功，请等待平台审核"
    │
    └── 失败 ────→ 显示错误提示
```

### 5.2 上传表单验证规则

| 字段 | 验证规则 |
|------|----------|
| 插件名称 | 必填，2-50 字符 |
| 插件描述 | 必填，10-2000 字符 |
| 插件分类 | 必填，从预设分类中选择 |
| 价格 | 付费时必填，> 0 |
| 收费模式 | 付费时必填 |
| 插件包 | 必填，.zip 格式，≤ 50MB |

---

## 6. 发布新版本流程

### 6.1 发布流程

```
用户点击"发布新版本"
    │
    ▼
弹出版本发布对话框
┌─────────────────────────────────────────┐
│  发布新版本                              │
│                                         │
│  📦 插件名称                            │
│  当前版本：v1.2.0                       │
│                                         │
│  新版本号 *                             │
│  ┌─────────────────────────────────────┐│
│  │ 1.3.0                               ││
│  └─────────────────────────────────────┘│
│  格式：x.y.z（如 1.3.0）                │
│                                         │
│  更新日志 *                             │
│  ┌─────────────────────────────────────┐│
│  │ • 新增 XXX 功能                     ││
│  │ • 修复 YYY 问题                     ││
│  └─────────────────────────────────────┘│
│                                         │
│  插件包 *                               │
│  ┌─────────────────────────────────────┐│
│  │  拖放文件到此处，或点击选择          ││
│  └─────────────────────────────────────┘│
│                                         │
│            [取消]  [发布版本]           │
└─────────────────────────────────────────┘
    │
    ▼
表单验证
    │
    ├── 验证失败 ────→ 显示错误提示
    │
    └── 验证通过
            │
            ▼
        调用发布版本 Server Action
            │
            ▼
┌─────────────────────────────────────────┐
│           Server Action 处理            │
│                                         │
│ 1. 验证用户是开发者                     │
│ 2. 验证插件归属                         │
│ 3. 验证插件状态为已上架                 │
│ 4. 验证版本号格式                       │
│ 5. 检查版本号是否已存在                 │
│ 6. 存储新版本插件包                     │
│ 7. 创建版本记录                         │
│ 8. 更新插件的当前版本                   │
│ 9. 重新验证相关页面缓存                 │
└─────────────────────────────────────────┘
    │
    ├── 成功 ────→ 显示成功提示
    │              "版本发布成功"
    │
    └── 失败 ────→ 显示错误提示
```

### 6.2 版本号验证规则

| 规则 | 说明 |
|------|------|
| 格式 | x.y.z（主版本.次版本.修订版本）|
| 唯一性 | 不能与已有版本重复 |
| 递增性 | 建议新版本 > 当前版本（不强制）|

---

## 7. 价格设置功能

### 7.1 价格设置对话框

```
┌─────────────────────────────────────────┐
│  价格设置                                │
│                                         │
│  📦 插件名称                            │
│                                         │
│  付费类型                               │
│  ○ 免费  ● 付费                        │
│                                         │
│  价格（¥）*                             │
│  ┌────────────┐                        │
│  │     99     │                        │
│  └────────────┘                        │
│                                         │
│  收费模式 *                             │
│  [一次性购买 ▼]                         │
│                                         │
│  ⚠️ 修改价格后，已购买用户不受影响       │
│                                         │
│            [取消]  [保存设置]           │
└─────────────────────────────────────────┘
```

### 7.2 价格修改规则

| 修改类型 | 影响 |
|----------|------|
| 免费 → 付费 | 已安装用户保持免费使用 |
| 付费 → 免费 | 所有用户免费，已购买用户不退款 |
| 价格调整 | 已购买用户不受影响 |
| 收费模式变更 | 已购买用户保持原权限 |

---

## 8. 下架和删除

### 8.1 下架插件

**适用条件**：插件状态为"已上架"

**流程**：

```
用户点击"下架插件"
    │
    ▼
弹出确认对话框
┌─────────────────────────────────────────┐
│  确定要下架「插件名」吗？                │
│                                         │
│  下架后：                               │
│  • 用户将无法在市场中搜索到此插件        │
│  • 已安装的用户可继续使用               │
│  • 您可以随时重新上架                   │
│                                         │
│            [取消]  [确认下架]           │
└─────────────────────────────────────────┘
    │
    ▼
调用下架 Server Action
更新插件状态为 removed
```

### 8.2 删除插件

**适用条件**：
- 插件无人安装
- 或插件状态为 pending/rejected

**流程**：

```
用户点击"删除插件"
    │
    ▼
弹出确认对话框
┌─────────────────────────────────────────┐
│  确定要删除「插件名」吗？                │
│                                         │
│  ⚠️ 此操作不可恢复！                     │
│                                         │
│  删除后：                               │
│  • 所有版本将被删除                     │
│  • 所有配置定义将被删除                 │
│                                         │
│            [取消]  [确认删除]           │
└─────────────────────────────────────────┘
    │
    ▼
调用删除 Server Action
    │
    ▼
检查是否有用户安装
    │
    ├── 有用户安装 ────→ 返回错误：有用户正在使用，请先下架
    │
    └── 无用户安装 ────→ 删除插件及相关数据
```

---

## 9. 数据统计 Tab

### 9.1 统计数据

| 统计项 | 说明 |
|--------|------|
| 总下载量 | 所有已上架插件的累计下载量 |
| 活跃用户 | 安装且正在运行的用户数 |
| 平均评分 | 所有已上架插件的平均评分 |
| 预估收入 | 付费插件的累计收入 |

### 9.2 图表展示

| 图表 | 数据 | 说明 |
|------|------|------|
| 下载趋势 | 最近 30 天每日下载量 | 折线图 |
| 插件下载排行 | 各插件下载量占比 | 饼图 |
| 收入趋势 | 最近 30 天每日收入 | 柱状图 |

---

## 10. 空状态设计

### 10.1 无插件

```
┌─────────────────────────────────────────┐
│                                         │
│              📦                         │
│                                         │
│        您还没有上传过插件                │
│                                         │
│        开始上传您的第一个插件吧          │
│                                         │
│           [上传新插件]                  │
│                                         │
└─────────────────────────────────────────┘
```
